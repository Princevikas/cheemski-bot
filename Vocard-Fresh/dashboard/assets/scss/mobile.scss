// ==========================================================
// Mobile Portrait Responsiveness
// ==========================================================
// This file contains all mobile-specific overrides for portrait orientation.
// Loaded last via @import "mobile" in dashboard-style.scss to ensure cascade precedence.

// ==========================================================
// BREAKPOINTS
// ==========================================================
// - 768px: Tablet / Large phones (landscape)
// - 480px: Small phones (portrait)
// - 360px: Very small phones

// ==========================================================
// MAIN GRID LAYOUT - Portrait Override
// ==========================================================
@media (max-width: 480px) {
    .main-grid-container {
        // Stack layout: header on top, main content in middle, controller at bottom
        grid-template-areas:
            "header header header"
            "main main main"
            "control control control";
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr auto;
        gap: 0;
    }

    // Hide menu and queue from normal flow - they become overlays
    .menu-container {
        display: none;

        &.active {
            display: flex;
        }
    }

    .queue-container {
        display: none;

        &.active {
            display: flex;
        }
    }
}

// ==========================================================
// HEADER - Portrait Adjustments
// ==========================================================
@media (max-width: 480px) {
    .header-container {
        padding: 0.5rem;
        gap: 0.25rem;
        flex-wrap: wrap;
        min-height: 3.5rem;

        // Ensure menu button is always visible
        .menu-bar-btn {
            display: flex !important;
            order: 1;
            flex-shrink: 0;
            width: 2.5rem;
            height: 2.5rem;
        }

        // Back button hidden on very small screens
        .back-page-btn {
            display: none;
        }
    }

    .search-container {
        flex: 1;
        min-width: 0;
        order: 2;

        .search-bar {
            max-width: 100%;
            padding: 0.5rem 0.75rem;

            input {
                font-size: 0.8125rem;
            }

            .material-symbols-outlined {
                font-size: 1.125rem;
            }
        }
    }

    // User menu and notifications
    .header-btn,
    .user-menu-container {
        order: 3;
        flex-shrink: 0;

        .btn {
            padding: 0.5rem;
        }
    }

    .user-avatar img {
        width: 2rem;
        height: 2rem;
    }
}

// ==========================================================
// MENU PANEL - Portrait Slide-in
// ==========================================================
@media (max-width: 480px) {
    .menu-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 85vw;
        max-width: 320px;
        height: 100%;
        height: 100dvh;
        z-index: 1002;
        background: var(--bg-dark);
        box-shadow: 4px 0 24px rgba(0, 0, 0, 0.6);
        transform: translateX(-100%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);

        &.active {
            display: flex;
            transform: translateX(0);
        }

        .scrollbar {
            padding: 1rem;
            padding-top: env(safe-area-inset-top, 1rem);
        }

        // Larger touch targets
        .section .menu-btn {
            padding: 0.875rem 1rem;
            min-height: 3rem;

            span {
                font-size: 1.375rem;
            }

            p {
                font-size: 1rem;
            }
        }

        .bot-selection .selected {
            padding: 0.875rem 1rem;
        }
    }

    // Menu overlay backdrop
    #menu-overlay.mobile-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        height: 100dvh;
        background: rgba(0, 0, 0, 0.6);
        z-index: 1001;
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
    }

    .menu-container.active~#menu-overlay.mobile-overlay {
        display: block;
    }
}

// ==========================================================
// QUEUE PANEL - Portrait Slide-in
// ==========================================================
@media (max-width: 480px) {
    .queue-container {
        position: fixed;
        top: 0;
        right: 0;
        width: 90vw;
        max-width: 360px;
        height: 100%;
        height: 100dvh;
        z-index: 1002;
        background: var(--bg);
        box-shadow: -4px 0 24px rgba(0, 0, 0, 0.5);
        transform: translateX(100%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);

        &.active {
            display: flex;
            transform: translateX(0);
        }

        .header {
            padding: 1rem 0.75rem;
            padding-top: calc(env(safe-area-inset-top, 0.5rem) + 0.5rem);

            h3 {
                font-size: 1.125rem;
            }
        }

        // Larger touch targets for tracks
        .section .track {
            padding: 0.75rem 1rem;
            min-height: 4rem;

            .thumbnail {
                min-width: 3.5rem;
                min-height: 3.5rem;
            }
        }
    }

    // Queue overlay backdrop
    #queue-overlay.mobile-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        height: 100dvh;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1001;
    }

    .queue-container.active~#queue-overlay.mobile-overlay {
        display: block;
    }
}

// Hide mobile-only elements on desktop (high specificity to override .btn rules)
.control-container .mini-progress-container,
.control-container .right .mobile-play-container {
    display: none !important;
}

// ==========================================================
// MINI PLAYER - YouTube Music Style (Portrait Only)
// ==========================================================
// Compact bottom bar: Album art + Title/Artist + Play button + Queue
// Tap anywhere to open fullplayer overlay

@media (max-width: 480px) {
    .control-container {
        padding: 0.5rem 0.75rem;
        padding-top: 1.5rem; // Extra padding for mini progress bar
        display: flex !important;
        flex-direction: row;
        align-items: center;
        gap: 0.75rem;
        min-height: 64px;
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 1) 100%);
        cursor: pointer;
        position: relative;

        // Mini squiggly progress bar at top
        .mini-progress-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 20px;
            display: block !important;
            z-index: 10;

            canvas {
                width: 100%;
                height: 100%;
            }
        }

        // Left side: Album art + Track info
        .left {
            display: flex !important;
            align-items: center;
            flex: 1;
            overflow: hidden;
            gap: 0.75rem;

            img {
                width: 48px;
                height: 48px;
                border-radius: 4px;
                flex-shrink: 0;
            }

            .track-info {
                display: flex !important;
                flex-direction: column;
                min-width: 0;
                flex: 1;
                gap: 2px;
                margin: 0;

                .title {
                    display: block !important;
                    font-size: 0.9375rem;
                    font-weight: 500;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    color: var(--text);
                    max-width: 100%; // Prevent overflow clipping
                }

                .description {
                    display: block !important;
                    font-size: 0.75rem;
                    color: var(--text-muted);
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    max-width: 100%; // Prevent overflow clipping
                }
            }

            #like-btn {
                display: none !important;
            }
        }

        // Hide entire center section on mobile (desktop play controls)
        .center,
        .center.important {
            display: none !important;
        }

        // Extra safety: hide the desktop play button ID specifically
        #play-pause-btn {
            display: none !important;
        }

        // Right side: Mobile play button + Queue button
        .right {
            display: flex !important;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0;

            // Hide volume and effects
            #squiggly-volume-container,
            .btn.non-essential {
                display: none !important;
            }

            // Mobile play button (shown only on mobile)
            .mobile-play-container {
                display: flex !important;
                padding: 0;
                background: none;

                #mobile-play-btn {
                    font-size: 2.5rem;
                    color: var(--text);
                }
            }

            // Queue button
            .btn.important {
                display: flex !important;
                padding: 0;
                background: none;

                .label {
                    display: none !important;
                }
            }

            #toggle-queue-view {
                font-size: 1.5rem;
                color: var(--text-muted);
            }
        }
    }
}

// ==========================================================
// VOLUME TOAST NOTIFICATION
// ==========================================================
.volume-toast {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 16px;
    padding: 1.5rem 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    z-index: 3000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease, transform 0.2s ease;
    min-width: 180px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);

    &.active {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }

    .volume-toast-icon {
        font-size: 2.5rem;
        color: var(--text);
    }

    .volume-toast-canvas {
        width: 120px;
        height: 40px;
    }

    .volume-toast-value {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text);
    }
}

// ==========================================================
// MAIN CONTENT AREA - Portrait
// ==========================================================
@media (max-width: 480px) {
    .main-container {
        .sections {
            padding: 0.5rem;
            gap: 1rem;

            .track-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
                margin: 0 0.5rem;

                img {
                    width: 6rem;
                    height: 6rem;
                }

                .left {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 0.75rem;
                    width: 100%;

                    .track-info {
                        width: 100%;

                        .large {
                            font-size: 1.25rem;
                        }

                        .middle {
                            font-size: 0.875rem;
                        }
                    }
                }
            }

            .track-row {
                padding: 0.5rem 0.75rem;

                img {
                    width: 2.75rem;
                    height: 2.75rem;
                    margin-left: 0;
                }

                .left {
                    gap: 0.5rem;
                    width: 85%;
                }
            }
        }

        // Card grid - 2 columns on very small screens
        .card-container {
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;

            .card {
                padding: 0.5rem;

                p {
                    font-size: 0.75rem;
                }
            }
        }

        // Section headers
        .section {
            margin: 0.5rem 0.25rem;

            .header .sub-title {
                h2 {
                    font-size: 1.125rem;
                }

                p {
                    font-size: 0.75rem;
                }
            }
        }

        // Settings pages
        .settings-row {
            flex-direction: column;
            gap: 0.75rem;

            .info {
                width: 100%;
            }
        }
    }
}

// ==========================================================
// FULLPLAYER - Portrait Enhancements
// ==========================================================
@media (max-width: 480px) {
    .fullplayer-overlay {

        // Swipe handle indicator
        &::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 2px;
            z-index: 10;
        }
    }

    .fullplayer-content {
        padding: 0.75rem;
        padding-top: 1.5rem;
        padding-bottom: env(safe-area-inset-bottom, 1rem);
    }

    .fp-header {
        padding-bottom: 0.5rem;

        .fp-close span {
            font-size: 1.5rem;
        }
    }

    .fp-artwork {
        width: calc(100vw - 3rem);
        height: calc(100vw - 3rem);
        max-width: 280px;
        max-height: 280px;
    }

    .fp-info {
        .fp-title {
            font-size: 1.125rem;
        }

        .fp-artist {
            font-size: 0.875rem;
        }
    }

    .fp-controls {
        gap: 1.5rem;

        .fp-btn span {
            font-size: 1.5rem;
        }

        .fp-btn.fp-play-btn {
            width: 56px;
            height: 56px;

            span {
                font-size: 2rem;
            }
        }
    }

    .fp-extras {
        gap: 1.25rem;

        .fp-volume {
            display: none;
        }
    }
}

// ==========================================================
// ALERTS & MODALS - Portrait
// ==========================================================
@media (max-width: 480px) {
    .alert-msg {
        width: 95vw;
        max-width: none;
        padding: 1.25rem;

        &.alert-msg__extended {
            width: 95vw;
        }

        .header h2 {
            font-size: 1.125rem;
        }
    }

    // Header panels (notifications, etc.)
    .header-btn .panel {
        position: fixed;
        top: 3rem;
        left: 0;
        right: 0;
        width: 100vw;
        max-height: 80vh;
        border-radius: 0 0 0.75rem 0.75rem;
    }

    .user-menu-panel {
        right: 0.5rem;
        min-width: 10rem;
    }
}

// ==========================================================
// VERY SMALL SCREENS (320px - 360px)
// ==========================================================
@media (max-width: 360px) {
    .header-container {
        padding: 0.375rem;
    }

    .control-container {
        .left {
            max-width: 35%;

            img {
                width: 2.25rem;
                height: 2.25rem;
            }

            .track-info .title {
                font-size: 0.75rem;
            }
        }

        .center .actions {
            gap: 0.5rem;
        }
    }

    .main-container .card-container {
        grid-template-columns: 1fr 1fr;

        .card p {
            font-size: 0.6875rem;
        }
    }
}